---
title: "Week 3 Lab: Exploring ggplot2"
author: "Team Peru"
date: today
format:
  html:
    toc: true
    toc-depth: 2
---

# 1 Visualizing the Distribution of Quantitative Data: Bill Lengths of Pygoscelis Penguins
 
```{r setup}
#| label: setup
#| include: false

# Install any CRAN packages weâ€™ll need, quietly
needed <- c("tidyverse", "palmerpenguins", "ggbeeswarm")
for(pkg in needed){
  if(!requireNamespace(pkg, quietly = TRUE)){
    install.packages(pkg)
  }
}

# load the only packages you'll need for this lab
library(tidyverse)
library(palmerpenguins)
```

## 1.1 Remove Missing Values

Penguins with an `NA` in `bill_length_mm` will cause ggplot2 warnings later on.  
Weâ€™ll:

1. Count how many rows have missing bill lengths.  
2. Remove those rows with `drop_na()`.  
3. Verify that no `NA` values remain.

```{r}
#| label: remove-missing

# Step 1: count rows with missing bill length
penguins %>% 
  filter(is.na(bill_length_mm)) %>% 
  count(name = "n_missing")

# Step 2: remove them
penguins_clean <- penguins %>% 
  drop_na(bill_length_mm)

# Step 3: verify zero missing remain
penguins_clean %>% 
  summarise(
    total_rows   = n(),
    n_missing    = sum(is.na(bill_length_mm))
  )
```


### Preview the Original Penguins Data

Before dropping any rows, letâ€™s look at the first few records and get a sense of how many bill-lengths are missing:
```{r}
#| label: preview-original
# Show the first six rows of the raw penguins tibble
head(penguins)
penguins
# Summarize total rows and how many have missing bill_length_mm
penguins %>%
  summarise(
    total_rows = n(),
    missing_bill_length = sum(is.na(bill_length_mm))
  )
```

## 1.2 Scatter Plot of Species versus Bill Length

Here we map bill length to the x-axis and species to the y-axis.  
We customize axis labels, add a title, and include the requested source citation.

```{r}
#| label: scatter-species-bill-length
#| message: false

penguins_clean %>%
  ggplot(aes(
    x = bill_length_mm,
    y = species
  )) +
  geom_point() +
  labs(
    x       = "Bill Length (mm)",
    y       = "Penguin Species",
    title   = "Bill Length by Penguin Species",
    caption = "Source: Gorman et al. (2014)"
  )
```
## 1.3 Why Should You Jitter the Plot?

We noticed in the plain scatter that tons of points land on the same spotâ€”many penguins of the same species have identical bill lengths. Letâ€™s prove it:

```{r}
#| label: why-jitter
#| message: false

penguins_clean %>%
  count(species, bill_length_mm) %>% 
  filter(n > 1) %>% 
  arrange(desc(n))
```
That returns an 84Ã—3 table showing all duplicate locations (e.g. 7 Adelies at 41.1 mm, 5 at 37.8 mm, etc.).

To see how many unique coordinate pairs there actually are, compare to the total distinct combinations:

```{r}
penguins_clean %>%
  distinct(species, bill_length_mm) %>%
  count()
```

Here youâ€™ll get distinct_pairs = 208 out of 342 rows, confirming that 134 measurements overlap. Those overlaps are exactly why a plain geom_point() hides the true number of penguinsâ€”jittering will spread them out so we can see each one.

## 1.4 Jitter Plot

To reveal all individual measurements without changing their exact billâ€length, weâ€™ll add only vertical jitter (so that points donâ€™t overlap within each species strip) and make the points semi-transparent. Hereâ€™s the setup:

```{r}
#| label: jitter-plot
#| message: false

penguins_clean %>%
  ggplot(aes(
    x = bill_length_mm,
    y = species
  )) +
  geom_jitter(
    width  = 0,    # no horizontal jitter
    height = 0.1,  # small vertical jitter so clusters stay distinct
    alpha  = 0.5   # semi-transparent points to show overplotting density
  ) +
  labs(
    x       = "Bill Length (mm)",
    y       = "Penguin Species",
    title   = "Jitter Plot of Bill Length by Species",
    caption = "Source: Gorman et al. (2014)"
  )
```
What you should see:

Points spread gently up and down around each species line so you can count every observation.

Reduced opacity (Î± = 0.5) highlights areas where many penguins share the same bill length.


### 1.5 Pre-requiste: Install ggbeeswarm (only needs to run once)

```{r}
#| label: install-beeswarm
#| include: false
if (!requireNamespace("ggbeeswarm", quietly = TRUE)) {
  install.packages("ggbeeswarm")
}
```

## 1.5 Bee-Swarm Plot

A bee-swarm plot arranges points in a compact â€œswarm,â€ preserving each exact bill-length on the x-axis but avoiding overlap by stacking them along the y-direction. Weâ€™ll use geom_beeswarm() from the ggbeeswarm package.

```{r}
#| label: bee-swarm
#| message: false

# load the ggbeeswarm package for geom_beeswarm()
library(ggbeeswarm)

penguins_clean %>%
  ggplot(aes(
    x = bill_length_mm,
    y = species
  )) +
  geom_beeswarm(
    size  = 1.8,      # medium point size
    alpha = 0.7,      # slightly transparent
    color = "steelblue"
  ) +
  labs(
    x       = "Bill Length (mm)",
    y       = "Penguin Species",
    title   = "Bee-Swarm Distribution of Penguin Bill Lengths",
    caption = "Source: Gorman et al. (2014)"
  )
```

What youâ€™ll see:

Each bill-length value sits exactly on the x-axis, but points are offset in the y-direction to avoid overplotting.

Compared to jitter, the beeswarm layout more clearly shows clumps of identical values without random noise.

## 1.6 Pros and Cons of Bee-Swarm Plots

What I like:
Bee-swarms neatly pack every identical bill-length value so you can see the exact counts without any random jitterâ€”no guessing how many points are hiding underneath.

What bugs me:
If you have a ton of duplicate measurements, the swarm can balloon or get squeezed, making it hard to compare across species (and it doesnâ€™t scale as gracefully to really large data sets).

## 1.7 Violin Plot with Boxes
Here we layer a violin plot (to show the full billâ€length distribution for each species) with a skinny box plot (to highlight the median and interquartile range).

```{r}
#| label: violin-box
#| message: false

penguins_clean %>%
  ggplot(aes(
    x = bill_length_mm,
    y = species
  )) +
  geom_violin(
    fill  = "lightblue",   # soft fill to show density
    color = "steelblue"    # outline color
  ) +
  geom_boxplot(
    width = 0.2,           # narrow box inside the violin
    fill  = "white",       # white box so the violin shows through
    color = "black"        # box outline
  ) +
  labs(
    x       = "Bill Length (mm)",
    y       = "Penguin Species",
    title   = "Distribution of Penguin Bill Lengths by Species",
    caption = "Source: Gorman et al. (2014)"
  )
```
What this shows:

Violins: the full shape of each speciesâ€™ billâ€length distribution (thicker regions mean more penguins at that length).

Boxes: the median line and interquartile range, giving a quick summary of center and spread.

From this, you can see that AdÃ©lie bill lengths are tightly clustered, while Gentoo and Chinstrap show wider variation.

## 1.8 What Does a Violin Plot Add to a Box Plot?

A boxplot tells me the â€œwhatâ€ (median, IQR, outliers) but hides the â€œhowâ€ of the distribution. A violin plot actually shows me where the data piles up or thins outâ€”any bumps, extra peaks, long tails, or skewâ€”so I get a real sense of the full shape instead of just a summary.

In short, the violin turns the â€œskeletonâ€ summary of a boxplot into a â€œflesh-and-bloodâ€ portrait of your dataâ€™s actual shape.

## 1.9 Frequency Polygons with Rug Plot

Next, letâ€™s overlay the three speciesâ€™ billâ€length distributions in one plot using frequency polygons, and add a colored rug along the bottom to show every individual measurement.

```{r}
#| label: freqpoly-rug
#| message: false

penguins_clean %>%
  ggplot(aes(
    x     = bill_length_mm,
    color = species
  )) +
  geom_freqpoly(
    binwidth = 1,    # 1 mm bins
    size     = 1     # slightly thicker lines
  ) +
  geom_rug(
    aes(color = species),
    sides   = "b",   # draw ticks only on bottom
    alpha   = 0.5    # semiâ€transparent so overlaps darken
  ) +
  labs(
    x       = "Bill Length (mm)",
    y       = "Count",
    color   = "Species",
    title   = "Bill Length Distributions by Species",
    caption = "Source: Gorman et al. (2014)"
  )
```

What this shows:

Each colored line traces the count of penguins in 1 mm bins for that species.

The rug ticks at the bottom mark every individual birdâ€™s bill length (darker areas where many overlap).

You can quickly compare that AdÃ©lie have shorter bills on average, while Gentoo and Chinstrap extend to larger lengths.

## 1.10 Faceted Frequency Polygons with Rug Plots

Here I split the billâ€length frequency polygons into three separate panelsâ€”one per speciesâ€”and tack a colored rug underneath each to show every individual measurement.

```{r}
#| label: freqpoly-faceted
#| message: false

penguins_clean %>%
  ggplot(aes(x = bill_length_mm)) +
  # draw a frequency polygon for each species
  geom_freqpoly(
    aes(color   = species),
    binwidth     = 1,
    size         = 1
  ) +
  # add a semiâ€transparent rug at the bottom of each panel
  geom_rug(
    aes(color   = species),
    sides         = "b",
    alpha         = 0.5
  ) +
  # facet into one panel per species
  facet_wrap(
    vars(species),
    ncol = 1
  ) +
  # labels and title
  labs(
    x       = "Bill Length (mm)",
    y       = "Count",
    color   = "Species",
    title   = "Faceted Bill Length Distributions of Penguin Species",
    caption = "Source: Gorman et al. (2014)"
  )
```

Why this helps:

Each species lives in its own panel, so the lines and rugs donâ€™t overlap across speciesâ€”much easier to see each distributionâ€™s shape.

The rug ticks still show raw data points, so you can spot gaps or clustering that the polygon alone might smooth over.

## 1.11 Pros and Cons of Faceting

Strength: Faceting gives each species its own panel, so thereâ€™s zero overlap between the curves and rugsâ€”you can really focus on the shape of each distribution without any visual clutter.

Weakness: It eats up a lot of space and forces you to jump between panels if you want to compare species directly, making cross-species comparisons less immediate than when everythingâ€™s overlaid in one plot.

## 1.12 Pairwise ð‘¡-Test
To back up our visual impression with statistics, weâ€™ll:

Compute the mean bill length for each species.

Run a pairwise ð‘¡-test on bill length by species and report the p-values.

```{r}
#| label: mean-bill-length
#| message: false

library(dplyr)

# 1. Calculate mean bill length per species
penguins_clean %>%
  group_by(species) %>%
  summarize(
    mean_bill_length_mm = mean(bill_length_mm),
    .groups = "drop"
  )
```
Interpretation. On average, Adelie bills are about 38.8 mm, Chinstrap bills about 48.8 mm, and Gentoo bills about 47.5 mm.

```{r}
#| label: pairwise-t-test
#| message: false

# 2. Pairwise t-tests (no p-value adjustment)
pairwise.t.test(
  x = penguins_clean$bill_length_mm,
  g = penguins_clean$species,
  p.adjust.method = "none"
)
```
| Comparison          | p-value     | Significance               |
| ------------------- | ----------- | -------------------------- |
| Adelie vs Chinstrap | < 2 Ã— 10â»Â¹â¶ | **p** â‰ª 0.05 â†’ significant |
| Adelie vs Gentoo    | < 2 Ã— 10â»Â¹â¶ | **p** â‰ª 0.05 â†’ significant |
| Chinstrap vs Gentoo | 0.0032      | **p** < 0.05 â†’ significant |

In plain terms:

AdÃ©lie penguins have significantly shorter bills than both Chinstraps and Gentoos.

Chinstrap bills are also significantly shorter than Gentoo bills.

So all three species differ from one another in mean bill length at the 5% level.
