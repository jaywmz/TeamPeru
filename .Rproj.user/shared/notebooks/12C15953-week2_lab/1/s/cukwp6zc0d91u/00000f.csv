"0","#| label: task2.3-parse"
"0","#| message: false"
"0",""
"0","sg_parsed <- sg_filtered %>%"
"0","  mutate("
"0","    age_group = str_trim(age_group),  # remove extra whitespace"
"0","    age = case_when("
"0","      str_detect(age_group, ""Under 1"")       ~ 0,"
"0","      str_detect(age_group, ""1 - 4"")         ~ 1,"
"0","      str_detect(age_group, ""\\d+ - \\d+"")   ~ as.numeric(str_extract(age_group, ""^\\d+"")),"
"0","      str_detect(age_group, ""\\d+ Years & Over"") ~ as.numeric(str_extract(age_group, ""^\\d+"")),"
"0","      TRUE                                   ~ NA_real_"
"0","    )"
"0","  ) %>%"
"0","  filter(!str_detect(age_group, ""^Total"")) %>%  # drop any ""Total ..."" rows"
"0","  drop_na(age, pop)"
"0",""
"0","sg_parsed_deduped <- sg_parsed %>%"
"0","  distinct(age, sex, year, .keep_all = TRUE) %>%"
"0","  arrange(age, sex, year)"
"0",""
"0","# Preview the first few rows"
"0","head(sg_parsed_deduped, 10)"
